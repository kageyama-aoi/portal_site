# 機能提案: ポータルカスタマイズ機能

## 1. 目的
本ドキュメントは、現在の単一目的のポータルサイトを、ユーザーが複数の異なるデータソース（JSONファイル）を切り替えて利用できる、汎用的なマルチポータルアプリケーションへと拡張するための機能実装案を定義するものです。

各ポータルに合わせたタイトル・サブタイトルの設定機能も併せて実装し、ユーザーの用途に応じた完全なカスタマイズ性の実現を目指します。

## 2. 主な変更点
本機能追加により、以下の変更が実装されます。

*   **データソースの動的切り替え**:
    *   デフォルトの `data.json` だけでなく、ユーザーが定義した任意の名前のJSONファイルをデータソースとして扱えるようになります。
*   **タイトル・サブタイトルの編集**:
    *   ページのメインタイトル（`h1`）とサブタイトル（`.note`）を、ユーザーが自由に変更できるようになります。
*   **ポータル管理機能**:
    *   上記の切り替えや編集を行うための、新しい設定画面（ポータル管理ダイアログ）を追加します。

## 3. 技術的アプローチ

### 3.1. 設定情報の保存
*   **保存場所**: ブラウザの `localStorage` を利用して、ポータルごとの設定情報を永続化します。これにより、ユーザーがページを再読み込みしても設定が維持されます。
*   **データ構造案**: `localStorage` に `portalAppConfig` というキーで、以下の様なJSON構造のデータを保存します。

    ```json
    {
      "activePortalId": "portal_1672531200000",
      "portals": {
        "portal_1672531200000": {
          "fileName": "data.json",
          "title": "📘 Study Portal",
          "subtitle": "目的のリソースへ最短でアクセスするためのマイポータル"
        },
        "portal_1672542300000": {
          "fileName": "gaming_links.json",
          "title": "🎮 Gaming Portal",
          "subtitle": "お気に入りのゲーム関連リンク集"
        }
      }
    }
    ```

### 3.2. アプリケーションの動作フロー
*   **起動処理 (`app.js`)**:
    1.  `localStorage` から `portalAppConfig` を読み込みます。
    2.  設定が存在しない場合、`data.json` を元にデフォルト設定を生成します。
    3.  `activePortalId` を元に、現在アクティブなポータルの設定オブジェクト（`fileName`, `title`, `subtitle`）を特定します。
    4.  特定した `fileName` を使って、対応するJSONデータを `fetch` します。
    5.  取得した `title` と `subtitle` をページの `h1` 要素と `.note` 要素に反映します。
*   **データ保存処理 (`dataManager.js`)**:
    *   `save()` メソッド実行時、現在アクティブなポータルの `fileName` を取得し、その名前で `json` ファイルを生成・ダウンロードさせます。
*   **既存のインポート機能の役割変更 (`ui.js`)**:
    *   「JSONファイルを読み込んで差し替える」機能は、インポート時に以下の2つの選択肢をユーザーに提示するように変更します。
        1.  **現在のポータルを上書きする**: 現在アクティブなポータルのデータを、読み込んだファイルの内容で置き換えます。（要保存）
        2.  **新規ポータルとして作成する**: 読み込んだファイルから新しいポータル設定を作成します。ファイル名とポータル名をユーザーに入力させ、`localStorage` に新しいエントリを追加します。

## 4. UIの変更案

### 4.1. ポータル管理ボタン
*   ヘッダーの「編集モード」トグルの隣に、**「ポータル管理」ボタン（⚙️アイコン）**を新設します。このボタンは常時表示されます。

### 4.2. ポータル管理ダイアログ
*   「ポータル管理」ボタンをクリックすると、新しいモーダルダイアログが開きます。このダイアログは以下のセクションで構成されます。

    *   **現在のポータル情報**:
        *   **タイトル**: `[現在のタイトル]` (編集可能な `input`)
        *   **サブタイトル**: `[現在のサブタイトル]` (編集可能な `input`)
        *   `[更新]` ボタン: 上記の変更を `localStorage` に保存します。

    *   **ポータル一覧**:
        *   `localStorage` に存在するポータルの一覧をラジオボタンで表示します。
        *   `[ポータル名] (ファイル名: [fileName])` の形式でリストアップします。
        *   選択中のラジオボタンが現在アクティブなポータルです。
        *   `[切り替え]` ボタン: 選択したポータルに切り替え、ページをリロードして反映させます。

    *   **新規ポータル作成**:
        *   **ポータル名**: `[新規ポータル名]` (入力 `input`)
        *   **ファイル名**: `[new_portal.json]` (入力 `input`, `.json`接尾辞を推奨)
        *   `[作成]` ボタン: 空のデータで新しいポータル設定を作成し、そのポータルに切り替えます。

## 5. 影響範囲
本機能の実装には、以下のファイルへの変更が必要です。

*   `index_tomomi.html`: 新しい「ポータル管理」ボタンとダイアログのHTML構造を追加。
*   `js/app.js`: 起動時の `localStorage` 読み込みと設定反映ロジックを追加。
*   `js/ui.js`: 「ポータル管理」ダイアログの表示・操作ロジックを実装。既存のインポート機能のロジックを変更。
*   `js/dataManager.js`: `save()` メソッドが動的なファイル名に対応できるように変更。
*   `index_tomomi.css`: 新しいダイアログやボタンのためのスタイルを追加。

既存の `data.json` を始めとする、リンクデータ用JSONファイルの内部構造（`categories`, `links` 配列など）に変更を加える必要はありません。
