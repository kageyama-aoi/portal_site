# テストケース提案 (Jest)

このドキュメントは、[My Portal Site] プロジェクトに Jest を用いて本格的なテストを導入するにあたり、テストすべき主要なケースを提案するものです。アプリケーションの主要モジュールである `dataManager.js` と `ui.js` に焦点を当て、ユニットテストの観点から記述します。

---

## 1. `dataManager.js` (データ管理モジュール) のテストケース案

このモジュールはアプリケーションのデータ操作ロジックの核であり、DOMやUIから独立してテストできるため、最初に手をつけるのに適しています。

### データの初期化と取得

*   `DataManager` が正しく初期化されること。
*   初期データが正しくロードされること、または空のデータで開始されること。
*   `getData()` が現在のデータ構造を返すこと。
*   `getCategory(id)` が指定したIDのカテゴリを返すこと。
*   `getLink(categoryId, linkId)` が指定したIDのリンクを返すこと。

### カテゴリ操作

*   新しいカテゴリが正しく追加されること。
*   既存のカテゴリのタイトルが更新されること。
*   カテゴリが正しく削除されること（中にリンクがあっても、なくても）。
*   カテゴリが正しい順序で移動できること。
*   存在しないカテゴリIDで操作した場合のエラーハンドリング。

### リンク操作

*   指定したカテゴリに新しいリンクが正しく追加されること。
*   既存のリンクのタイトル、URL、アイコン、バッジ、メモなどが更新されること。
*   リンクが正しく削除されること。
*   複数リンクの一括追加（`addBulkLinks`）が正しく機能すること。
*   存在しないカテゴリIDやリンクIDで操作した場合のエラーハンドリング。

### ダーティ状態管理

*   データが変更された際に `hasUnsavedChanges` フラグが `true` になること。
*   `markAsClean()` が `hasUnsavedChanges` を `false` にリセットすること。
*   `onDirty` コールバック関数がデータ変更時に呼び出されること。

### データ永続化 (モック使用)

*   `saveData()` が LocalStorage または指定された保存メカニズム（Jestのモック機能を使用）にデータを正しく書き込むこと。
*   `loadData()` が LocalStorage または指定された読み込みメカニズム（Jestのモック機能を使用）からデータを正しく読み込むこと。
*   データのインポート/エクスポート機能が正しく動作すること。

---

## 2. `ui.js` (ユーザーインターフェースモジュール) のテストケース案

このモジュールはDOM操作やイベント処理が関わるため、JestのJSDOM環境やモックを積極的に使用する必要があります。

### 初期レンダリング

*   `render()` メソッド呼び出し後、DOMにカテゴリとリンクが正しく表示されること。
*   カテゴリの `isOpen` 状態に応じて、展開/折りたたみ状態がDOMに反映されること。
*   リンクのタイトル、URL、アイコン、バッジ、メモなどがDOMに正しく表示されること。

### 編集モードのトグル

*   編集モードのON/OFFで、UI要素（編集ボタン、追加プレースホルダーなど）の表示/非表示が正しく切り替わること。

### ダイアログの表示/非表示

*   カテゴリ追加/編集ボタンクリック時に、対応するダイアログ（例: `categoryDialog`）が適切に開かれること。
*   リンク追加/編集ボタンクリック時に、対応するダイアログ（例: `linkDialog`）が適切に開かれること。
*   ダイアログが正しいデータで初期化されること。

### イベントハンドリング

*   カテゴリのタイトルクリックで、カテゴリの展開/折りたたみ状態が切り替わること。
*   （高度）ドラッグ＆ドロップによるカテゴリやリンクの並び替えがUI上で正しく機能すること。
*   UI上の操作（例: カテゴリ追加ボタンクリック）が、`DataManager`の適切なメソッドを呼び出すこと。

### フォーム入力とUI更新

*   ダイアログでの入力値が `DataManager` に渡され、データが更新された後にUIが適切に再レンダリングされること。

---

## テストの開始点

まずは、DOMやブラウザAPIに依存せず、Jestの環境で比較的簡単にユニットテストを記述できる **`dataManager.js` のテストケース**から書き始めることを強くお勧めします。これにより、アプリケーションのコアロジックの堅牢性を確保できます。

`ui.js` のテストは、DOMのモック化、JSDOM環境のセットアップ、イベントのシミュレーションなど、より複雑な準備が必要になるため、`dataManager.js` のテストが確立してから取り組むのが効率的です。
