# My Portal Site

これは、ローカルで動作するパーソナルなポータルサイトを管理するためのWebアプリケーションです。カテゴリごとにリンクを整理し、複数のポータルを切り替えて使用することができます。

## 主な機能

- カテゴリとリンクの作成、編集、削除 (CRUD)
- ドラッグ＆ドロップによるカテゴリとリンクの並び替え
- 複数のポータル管理機能
- 編集モードによる安全な操作
- ポータルデータのエクスポート（保存）とインポート（読み込み）

## セットアップと実行

本アプリケーションは、ローカル環境で直接 `index.html` ファイルを開くことで動作します。特別なWebサーバーの設定は不要です。

1. プロジェクトのファイルをダウンロードまたはクローンします。
2. `index.html` ファイルをウェブブラウザで開きます。

## プロジェクト構成

```
.
├── .gitignore               # Git管理から除外するファイルを指定
├── index.html               # アプリケーションのメインHTMLファイル
├── README.md                # このドキュメント
├── style.css                # アプリケーションのメインスタイルシート
├── test.html                # テスト用のHTMLファイル (開発用)
├── data/                    # ポータルデータを格納するディレクトリ
│   ├── data.json            # デフォルトのポータルデータ
│   └── data (2).json        # バックアップまたは別のデータファイル
├── DOCS/                    # プロジェクトに関するドキュメント
│   ├── CURRENT_STATE_ANALYSIS.md # 現在の状態分析ドキュメント
│   ├── mark.md              # マークダウンテスト用ファイル？
│   ├── NIGHT_MODE_PROPOSAL.md    # ナイトモードに関する提案書
│   ├── PORTAL_CUSTOMIZATION_PROPOSAL.md # ポータルカスタマイズに関する提案書
│   └── TECHNICAL_SPEC.md    # 技術仕様書
├── js/                      # JavaScriptソースコード
│   ├── app.js               # アプリケーションのエントリーポイントと初期化
│   ├── configManager.js     # ポータル設定の管理
│   ├── dataManager.js       # データの状態管理と永続化ロジック
│   ├── iconList.js          # アプリケーションで使用される絵文字アイコンのリスト
│   ├── ui.js                # メインUIの描画とイベント処理
│   └── dialogs/             # 各種ダイアログのロジック
│       ├── bulkLinkDialog.js  # 複数リンク一括追加ダイアログ
│       ├── categoryDialog.js  # カテゴリ編集ダイアログ
│       ├── iconPickerDialog.js# アイコン選択ダイアログ
│       ├── linkDialog.js      # リンク編集ダイアログ
│       └── portalDialog.js    # ポータル管理ダイアログ
└── test/                    # テストコード
    ├── dataManager.test.js  # DataManagerの単体テスト
    ├── run-tests.js         # テスト実行スクリプト
    └── ui.test.js           # UI関連のテスト
```

## メンテナンスガイドライン

このプロジェクトは、関心の分離（Separation of Concerns）を重視して設計されています。メンテナンスや機能追加を行う際は、以下のファイル構成と方針に従ってください。

### JavaScriptファイルの役割

- **`app.js` (エントリーポイント)**
  - アプリケーション全体の初期化を行います。
  - `DataManager`, `ConfigManager`, `UI`, 各`Dialog`クラスのインスタンスを生成し、それぞれを連携させます（依存性の注入）。
  - 新しいダイアログを追加した場合は、このファイルでインスタンス化して`UI`に渡す必要があります。

- **`dataManager.js` (データ層)**
  - カテゴリやリンクのデータに対するすべての操作（追加、更新、削除、移動など）を担当します。
  - データの状態（未保存の変更があるかなど）を管理します。
  - `data.json`の読み込み（fetch）や書き出し（ダウンロード）といった永続化に関するロジックもここに集約されています。
  - **方針:** データ構造やデータに関するロジックの変更は、すべてこのファイル内で行ってください。

- **`configManager.js` (設定層)**
  - 複数のポータルの設定（アクティブなポータル、ポータル一覧など）を管理します。
  - `localStorage`を利用して、どのポータルを使用しているかを記憶します。
  - **方針:** ポータルの切り替えや新規作成など、ポータル設定に関するロジックは、このファイル内で行ってください。

- **`ui.js` (UI層 - メインビュー)**
  - `DataManager`から取得したデータを元に、メイン画面（カテゴリとリンクの一覧）のHTMLを構築（レンダリング）します。
  - 編集モードの切り替え、全開閉ボタンなど、メイン画面に直接関わるイベントリスナーを初期化します。
  - 各ダイアログのインスタンスを保持し、適切なボタンが押された際にダイアログを開く役割を持ちます。
  - **方針:** メイン画面の見た目や動作に関する変更はこのファイルで行います。ダイアログの「中身」のロジックはここには含めません。

- **`iconList.js` (ユーティリティ)**
  - アプリケーション全体で使用される絵文字アイコンのリストを提供します。主に`iconPickerDialog.js`などで利用されます。
  - **方針:** 利用可能なアイコンの種類を追加・変更する場合はこのファイルを編集します。

- **`dialogs/` ディレクトリ (UI層 - ダイアログ)**
  - 各ダイアログ（ポップアップウィンドウ）のロジックが、それぞれ独立したクラスとして格納されています。
  - 各ダイアログファイルは、自身の表示、イベント処理、入力値の取得、そして`DataManager`や`ConfigManager`への処理の依頼といった、自身に関わるすべての責務を持ちます。
  - **方針:**
    - **既存のダイアログを修正する場合:** `dialogs`ディレクトリ内の対応するファイル（例: リンク追加ダイアログなら`linkDialog.js`）を修正してください。
    - **新しいダイアログを追加する場合:** `dialogs`ディレクトリに新しいJSファイルを作成し、既存のダイアログクラスを参考に新しいクラスを実装してください。その後、`app.js`でそのクラスをインスタンス化し、`ui.js`に渡すように修正します。

### メンテナンスの例

**例1: リンクに「公開/非公開」フラグを追加したい**

1.  `dataManager.js`の`addLink`, `updateLink`を修正し、新しいフラグをデータオブジェクトに含めるようにします。
2.  `ui.js`の`_createLinkCard`メソッドを修正し、フラグの状態に応じて見た目が変わるようにします（例: 非公開ならグレーアウトさせる）。
3.  `dialogs/linkDialog.js`を修正し、ダイアログ内に「公開/非公開」を切り替えるためのチェックボックスなどを追加し、保存時にその値を`DataManager`に渡すようにします。

**例2: 新しい「テーマ変更」ダイアログを追加したい**

1.  `dialogs/`に`themeDialog.js`という新しいファイルを作成します。
2.  `themeDialog.js`内に、テーマ選択のUIを操作し、選択されたテーマを`localStorage`に保存するなどのロジックを持つ`ThemeDialog`クラスを実装します。
3.  `app.js`で`ThemeDialog`をインポートしてインスタンス化します。
4.  `ui.js`を修正して`ThemeDialog`のインスタンスを受け取り、ヘッダーの「テーマ変更」ボタンが押されたら`themeDialog.open()`を呼び出すようにします。